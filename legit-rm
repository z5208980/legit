#!/bin/bash

cached="0";
forced="0";
for i in "$@"
do
    # echo "$i";
    if [ "$i" =  "--cached" ]; then
        # echo "-a";
        cached="1";
    elif [ "$i" = "--force" ]; then
        # echo "-m";
        forced="1";
    #     #file

    fi
done
# echo "$cached"; echo "$forced";

if [ "$#" -eq 0 ]; then
    echo "usage: legit-rm [--force] [--cached] <filenames>"
    exit 0;
fi

#echo "index";
#for i in `ls $index`
#do
#    echo "$i";
#done

index='.legit/index';
if [ $cached -eq "1" ] && [ $forced -eq "1" ]; then
    # echo "--cached";
    for i in "$@"
    do
        # echo "$i";
        if [ "$i" = "--cached" ] || [ "$i" = "--force" ] ; then
            continue;
        elif [ -f "$index/$i" ]; then
            # echo "deleting: $i | from: $index/$i";
            rm "$index/$i";
        else
            echo "legit-rm: error: '$i' is not in the legit repository";
        fi
    done
elif [ $cached -eq "1" ]; then
    # echo "--cached";
    for i in "$@"
    do
        # echo "$i";
        if [ "$i" = "--cached" ] || [ "$i" = "--force" ] ; then
            continue;
        elif [ -f "$index/$i" ]; then
            # echo "deleting: $i | from: $index/$i";
            rm "$index/$i";
        else
            echo "legit-rm: error: '$i' is not in the legit repository";
        fi
    done
elif [ $forced -eq "1" ]; then
    # echo "--force";
    for i in "$@"
    do
        # echo "$i";
        if [ "$i" = "--cached" ] || [ "$i" = "--force" ] ; then
            continue;
        elif [ -f "$index/$i" ]; then
            # echo "deleting: $i | from: $index/$i";
            rm "$index/$i";
        else
            echo "legit-rm: error: '$i' is not in the legit repository";
        fi

        if [ -f "$i" ]; then
            rm "$i";    # delete from HEAD
        fi
        sed -i -e "/^$i\$/d" "$index/.status"; # delete from status
        # remove -e and remove this code
        rm "$index/.status-e";

    done
else
    # echo "--both";
    for i in "$@"
    do
        # echo "$i";
        # if [ "$i" == "--cached" ] || [ "$i" == "--force" ] ; then
        #     continue;
        if [ -f "$index/$i" ]; then     # delete from index
            # echo "deleting: $i | from: $index/$i";
            rm "$index/$i";
        else
            echo "legit-rm: error: '$i' is not in the legit repository";
        fi
        rm "$i";    # delete from HEAD
    done
fi

# $ echo 4 >>a
# $ echo 5 >>b
# $ echo 6 >>c
# $ echo 7 >d
# $ echo 8 >e
# $ legit-add b c d e
# $ echo 9 >b
# $ echo 0 >d
# $ legit-rm --cached a c
# $ legit-rm --force --cached b
# $ legit-rm --force --cached e
# $ legit-rm --force d
# $ legit-status
# a - untracked
# b - untracked
# c - untracked
# e - untracked
