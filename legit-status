#!/usr/bin/env dash

index='.legit/index';            # MAKE SURE TO CHANGE .git
commit_num="0";                       # Get latest repo #
msg_file='.legit/COMMIT_EDITMSG';
if [ -s $msg_file ]; then            # Not Empty
     commit_num=`cut -d' ' -f1 $msg_file`;
fi
repo='.legit/logs/repo';
snapshot="$repo/.snapshot.$commit_num";

# echo $snapshot;
# for i in `ls $snapshot`
# do
#     echo "$i";
# done
#
# # index_files=`cut -d' ' -f2 "$index/.index"`;
# echo "$index";
# echo "`cut -d' ' -f1 "$index/.index"`";
# echo "$snapshot";

for i in `cat "$index/.status"`
do
    echo "main: `shasum $i`";
    echo "repo: `shasum "$snapshot/$i"`";

    if [ -f "$index/$i" ] && [ ! -f "$snapshot/$i" ] && [ -f "$i" ]; then
        echo "$i - added to index";
    elif [ -f "$index/$i" ] && [ -f "$snapshot/$i" ] && [ -f "$i" ]; then
        echo "$i - same as repo";
    elif [ ! -f "$i" ] && [ -f "$index/$i" ]; then
        # file: !HEAD >index >snapshot
        echo "$i - file deleted";
    elif [ ! -f "$i" ] && [ ! -f "$index/$i" ]; then
        # file: !HEAD !index >snapshot
        echo "$i - deleted";
    #### After checking that the files are not deleted, check it they have changed ####
# elif [ `shasum $i` == "0" ]; then
#         # file has changed but not yet legit-add
#         echo "$i - file has changed";
    else
        echo "$i - untracked";
    fi
done

# for i in `ls`
# do
#     # NEED TO TURN INTO HASH
#     # echo "$i";
#
#     if [ -f "$index/$i" ] && [ ! -f "$snapshot/$i" ]; then
#         echo "$i - added to index";
#     elif [ -f "$index/$i" ] && [ -f "$snapshot/$i" ]; then
#         echo "$i - same as repo";
#     elif [ ! -f "$i" ] && [ -f "$index/$i" ]; then
#         # file: !HEAD >index >snapshot
#         echo "$i - file deleted";
#     elif [ ! -f "$i" ] && [ ! -f "$index/$i" ]; then
#         # file: !HEAD !index >snapshot
#         echo "$i - deleted";
#     else
#         echo "$i - untracked";
#     fi
#
# done
